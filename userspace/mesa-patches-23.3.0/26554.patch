From 8cb7b0ed9074493faca6c1b57b95ec1bf5e12bd3 Mon Sep 17 00:00:00 2001
From: David Heidelberg <david.heidelberg@collabora.com>
Date: Wed, 6 Dec 2023 21:49:06 +0100
Subject: [PATCH] freedreno: implement PIPE_CAP_TIMER_RESOLUTION

Allows rusticl to create queues with profiling enabled.

Fixes: 660f2eabe11 ("gallium: add PIPE_CAP_TIMER_RESOLUTION")

Signed-off-by: David Heidelberg <david.heidelberg@collabora.com>
---
 src/gallium/drivers/freedreno/freedreno_screen.c | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/src/gallium/drivers/freedreno/freedreno_screen.c b/src/gallium/drivers/freedreno/freedreno_screen.c
index 6cadea8c2eb61..e75d21eadee38 100644
--- a/src/gallium/drivers/freedreno/freedreno_screen.c
+++ b/src/gallium/drivers/freedreno/freedreno_screen.c
@@ -590,6 +590,8 @@ fd_screen_get_param(struct pipe_screen *pscreen, enum pipe_cap param)
       /* only a4xx, requires new enough kernel so we know max_freq: */
       return (screen->max_freq > 0) &&
              (is_a4xx(screen) || is_a5xx(screen) || is_a6xx(screen));
+   case PIPE_CAP_TIMER_RESOLUTION:
+      return DIV_ROUND_UP(1000000000ull, 19200000); /* RBBM timer */
    case PIPE_CAP_QUERY_BUFFER_OBJECT:
    case PIPE_CAP_QUERY_SO_OVERFLOW:
    case PIPE_CAP_QUERY_PIPELINE_STATISTICS_SINGLE:
-- 
GitLab

